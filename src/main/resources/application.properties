##########################################################################
####################     SERVER CONFIG     ################################
##########################################################################

server.port=${LISTEN_PORT}
# Native support for X-Forwarded headers
server.forward-headers-strategy=native

# Trust all internal proxies (crucial for Docker)
server.tomcat.remoteip.internal-proxies=.*

# Header definitions
server.tomcat.remoteip.protocol-header=X-Forwarded-Proto
server.tomcat.remoteip.remote-ip-header=X-Forwarded-For
server.tomcat.remoteip.port-header=X-Forwarded-Port
server.tomcat.remoteip.protocol-header-https-value=https

##########################################################################
####################     SPRING CONFIG     ##############################
##########################################################################
spring.threads.virtual.enabled=true

##########################################################################
####################     DATABASE CONFIG     #############################
##########################################################################
spring.liquibase.enabled=true
spring.liquibase.change-log=classpath:db/changelog/db.changelog-master.yaml
spring.liquibase.parameters.enable-substitution=true

spring.jpa.database=POSTGRESQL
spring.datasource.driverClassName=org.postgresql.Driver
spring.datasource.url=jdbc:postgresql://${POSTGRESQL_HOST}:${POSTGRESQL_PORT}/${POSTGRESQL_DB_NAME}?reWriteBatchedInserts=true
spring.datasource.username=${POSTGRESQL_USERNAME}
spring.datasource.password=${POSTGRESQL_PASSWORD}

spring.datasource.hikari.maximum-pool-size=16
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.testWhileIdle=true
spring.datasource.validationQuery=SELECT 1

spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.jdbc.batch_size=500
spring.jpa.properties.hibernate.id.optimizer.batch_size=500
spring.jpa.properties.hibernate.id.new_generator_mappings=true
spring.jpa.properties.hibernate.rewrite_batched_inserts=true
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false
spring.jpa.properties.hibernate.jdbc.fetch_size=100

############################################################################
####################     GOLDENERA WALLET     ##############################
############################################################################

ge.node.base-url=${NODE_BASE_URL}
ge.node.api-key=${NODE_API_KEY}
ge.node.webhook-secret-key=${NODE_WEBHOOK_SECRET_KEY}
ge.node.webhook-uid=${NODE_WEBHOOK_UID}

###### SECURITY CONFIG #####

# Basic auth for /api/admin area
spring.security.user.name=${ADMIN_USERNAME}
spring.security.user.password={noop}${ADMIN_PASSWORD}
spring.security.user.roles=ADMIN

# Throttling
ge.throttling.global-capacity=${THROTTLING_GLOBAL_CAPACITY}
ge.throttling.global-refill-tokens=${THROTTLING_GLOBAL_REFILL_TOKENS}

ge.throttling.public-core-capacity=${THROTTLING_PUBLIC_CORE_CAPACITY}
ge.throttling.public-core-refill-tokens=${THROTTLING_PUBLIC_CORE_REFILL_TOKENS}